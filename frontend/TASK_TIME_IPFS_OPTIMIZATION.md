# ä»»åŠ¡æ—¶é—´æ˜¾ç¤ºå’ŒIPFSå“ˆå¸Œä¼˜åŒ–

## ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦é’ˆå¯¹ä»»åŠ¡å¤§å…çš„ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š
1. **å±è”½æ— æ•ˆçš„IPFSå“ˆå¸Œ**ï¼šé¿å…æ˜¾ç¤ºæŸåæˆ–æ— æ•ˆçš„IPFSæ•°æ®
2. **ä¼˜åŒ–æˆªæ­¢æ—¶é—´å±•ç¤º**ï¼šæ ¹æ®ä»»åŠ¡å½“å‰çŠ¶æ€æ˜¾ç¤ºå¯¹åº”çš„æˆªæ­¢æ—¶é—´

## ä¼˜åŒ–å†…å®¹

### 1. æ™ºèƒ½æ—¶é—´æ˜¾ç¤ºç³»ç»Ÿ

#### 1.1 çŠ¶æ€ç›¸å…³çš„æˆªæ­¢æ—¶é—´
æ ¹æ®ä»»åŠ¡çŠ¶æ€æ˜¾ç¤ºç›¸åº”çš„æˆªæ­¢æ—¶é—´ç±»å‹ï¼š

| ä»»åŠ¡çŠ¶æ€ | æ˜¾ç¤ºæ–‡æœ¬ | æ—¶é—´è®¡ç®—é€»è¾‘ |
|---------|---------|-------------|
| 0 - å·²åˆ›å»º | ä»»åŠ¡æˆªæ­¢ | æ˜¾ç¤ºä¸»æˆªæ­¢æ—¶é—´ |
| 1 - ç«æ ‡ä¸­ | ç«æ ‡æˆªæ­¢ | ç«æ ‡æœŸç»“æŸæ—¶é—´ vs ä¸»æˆªæ­¢æ—¶é—´ï¼ˆå–è¾ƒæ—©è€…ï¼‰ |
| 2 - å¼€å‘ä¸­ | å¼€å‘æˆªæ­¢ | æ˜¾ç¤ºä¸»æˆªæ­¢æ—¶é—´ |
| 3 - å¾…é›‡ä¸»ç¡®è®¤ | ç¡®è®¤æˆªæ­¢ | æ˜¾ç¤ºä¸»æˆªæ­¢æ—¶é—´ |
| 4 - å·²å®Œæˆ | å·²å®Œæˆ | ä¸æ˜¾ç¤ºæˆªæ­¢æ—¶é—´ |
| 5 - äº‰è®®ä¸­ | äº‰è®®æˆªæ­¢ | äº‰è®®æˆªæ­¢æ—¶é—´ |
| 6 - äº‰è®®æœŸ | äº‰è®®æœŸæˆªæ­¢ | äº‰è®®æœŸæˆªæ­¢æ—¶é—´ |

#### 1.2 æ—¶é—´è®¡ç®—å‡½æ•°

**`getCurrentDeadline(task)`**
- æ ¹æ®ä»»åŠ¡çŠ¶æ€è®¡ç®—å½“å‰ç›¸å…³çš„æˆªæ­¢æ—¶é—´
- ç«æ ‡é˜¶æ®µï¼šè®¡ç®—ç«æ ‡æœŸç»“æŸæ—¶é—´
- å¼€å‘é˜¶æ®µï¼šä½¿ç”¨ä¸»æˆªæ­¢æ—¶é—´
- äº‰è®®é˜¶æ®µï¼šä½¿ç”¨äº‰è®®æˆªæ­¢æ—¶é—´

**`getTimeStatus(task)`**
- è¿”å›çŠ¶æ€ç›¸å…³çš„æ—¶é—´æè¿°æ–‡æœ¬
- åŠ¨æ€æ˜¾ç¤ºå½“å‰é˜¶æ®µçš„æ—¶é—´ç±»å‹

**`getTimeRemaining(task)`**
- åŸºäºå½“å‰æˆªæ­¢æ—¶é—´è®¡ç®—å‰©ä½™æ—¶é—´
- æ™ºèƒ½æ˜¾ç¤ºæ ¼å¼ï¼šå¤©+å°æ—¶ / å°æ—¶ / åˆ†é’Ÿ
- å·²å®Œæˆä»»åŠ¡æ˜¾ç¤º"å·²å®Œæˆ"

#### 1.3 æ—¶é—´é¢œè‰²ç¼–ç 
- ğŸ”´ çº¢è‰²ï¼šå·²è¿‡æœŸæˆ–24å°æ—¶å†…
- ğŸŸ¡ é»„è‰²ï¼š72å°æ—¶å†…
- ğŸŸ¢ ç»¿è‰²ï¼šå……è¶³æ—¶é—´æˆ–å·²å®Œæˆ
- âš« ç°è‰²ï¼šæ— æˆªæ­¢æ—¶é—´

### 2. IPFSå“ˆå¸ŒéªŒè¯å’Œå±è”½

#### 2.1 æ— æ•ˆå“ˆå¸Œæ£€æµ‹
```javascript
const shouldShowIPFSInfo = (task) => {
  // æ£€æŸ¥å“ˆå¸Œæ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ
  if (!task.ipfsHash || task.ipfsHash === '0' || task.ipfsHash === '') {
    return false
  }
  
  // ä½¿ç”¨IPFSå­˜å‚¨çš„éªŒè¯å‡½æ•°
  if (ipfsStore.isValidIPFSHash && !ipfsStore.isValidIPFSHash(task.ipfsHash)) {
    return false
  }
  
  // æ£€æŸ¥é”™è¯¯æ ‡è®°
  if (task.metadata && task.metadata.error === 'Invalid IPFS hash') {
    return false
  }
  
  return true
}
```

#### 2.2 æ•°æ®æ¥æºæ ‡è¯†
ä¸ºä»»åŠ¡å¡ç‰‡æ·»åŠ æ•°æ®æ¥æºæ ‡è¯†ï¼ˆä»…åœ¨è°ƒè¯•æ¨¡å¼æ˜¾ç¤ºï¼‰ï¼š

| æ•°æ®æ¥æº | æ ‡è¯† | é¢œè‰² | è¯´æ˜ |
|---------|------|------|------|
| åŸºç¡€ä¿¡æ¯ | ğŸ“„ | ç°è‰² | ä»…é“¾ä¸Šæ•°æ®ï¼Œæ— IPFS |
| å®Œæ•´ä¿¡æ¯ | âœ… | ç»¿è‰² | é“¾ä¸Š+IPFSå®Œæ•´æ•°æ® |
| é“¾ä¸Šæ•°æ® | â›“ï¸ | è“è‰² | ä»…é“¾ä¸Šæ•°æ®å¯ç”¨ |
| æ•°æ®å—é™ | âš ï¸ | çº¢è‰² | IPFSå“ˆå¸Œæ— æ•ˆ |

#### 2.3 IPFSå“ˆå¸ŒéªŒè¯è§„åˆ™
åœ¨ `frontend/src/stores/ipfs.js` ä¸­çš„éªŒè¯é€»è¾‘ï¼š

```javascript
isValidIPFSHash(hash) {
  if (!hash || typeof hash !== 'string') return false
  if (hash.length < 10) return false
  
  // æ”¯æŒå¤šç§IPFSå“ˆå¸Œæ ¼å¼
  const ipfsV0Regex = /^Qm[1-9A-HJ-NP-Za-km-z]{44}$/  // v0 CID
  const ipfsV1Regex = /^b[a-z2-7]{58,}$/              // v1 CID
  const base58Regex = /^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]+$/
  
  return ipfsV0Regex.test(hash) || 
         ipfsV1Regex.test(hash) || 
         (base58Regex.test(hash) && hash.length >= 44)
}
```

## ä¿®æ”¹çš„æ–‡ä»¶

### 1. frontend/src/views/Tasks.vue
- âœ… é‡æ„æ—¶é—´æ˜¾ç¤ºé€»è¾‘
- âœ… æ·»åŠ IPFSå“ˆå¸ŒéªŒè¯
- âœ… ä¼˜åŒ–æ—¶é—´çŠ¶æ€æ–‡æœ¬
- âœ… æ·»åŠ æ•°æ®æ¥æºæ ‡è¯†ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰

### 2. æ–°å¢åŠŸèƒ½å‡½æ•°
- `getCurrentDeadline(task)` - è·å–å½“å‰çŠ¶æ€å¯¹åº”çš„æˆªæ­¢æ—¶é—´
- `getTimeStatus(task)` - è·å–æ—¶é—´çŠ¶æ€æ–‡æœ¬
- `getTimeRemaining(task)` - è·å–å‰©ä½™æ—¶é—´æ˜¾ç¤º
- `getTimeClass(task)` - è·å–æ—¶é—´é¢œè‰²æ ·å¼
- `shouldShowIPFSInfo(task)` - æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºIPFSä¿¡æ¯
- `getTaskDataSource(task)` - è·å–æ•°æ®æ¥æºæ ‡è¯†

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### 1. æ—¶é—´ä¿¡æ¯æ›´ç²¾ç¡®
- ç«æ ‡é˜¶æ®µæ˜¾ç¤ºç«æ ‡æˆªæ­¢æ—¶é—´
- å¼€å‘é˜¶æ®µæ˜¾ç¤ºå¼€å‘æˆªæ­¢æ—¶é—´
- äº‰è®®é˜¶æ®µæ˜¾ç¤ºäº‰è®®æˆªæ­¢æ—¶é—´
- å·²å®Œæˆä»»åŠ¡ä¸æ˜¾ç¤ºæ··æ·†çš„æ—¶é—´ä¿¡æ¯

### 2. æ•°æ®è´¨é‡é€æ˜åŒ–
- è‡ªåŠ¨å±è”½æ— æ•ˆIPFSæ•°æ®
- åœ¨è°ƒè¯•æ¨¡å¼ä¸‹æ˜¾ç¤ºæ•°æ®æ¥æº
- ç”¨æˆ·å¯ä»¥äº†è§£ä»»åŠ¡ä¿¡æ¯çš„å®Œæ•´æ€§

### 3. è§†è§‰ä¼˜åŒ–
- é¢œè‰²ç¼–ç å¿«é€Ÿè¯†åˆ«æ—¶é—´ç´§æ€¥ç¨‹åº¦
- çŠ¶æ€ç›¸å…³çš„æ—¶é—´æè¿°æ›´æ¸…æ™°
- å‡å°‘æ— æ•ˆä¿¡æ¯çš„å¹²æ‰°

## è°ƒè¯•åŠŸèƒ½

åœ¨URLä¸­æ·»åŠ  `?debug=1` å‚æ•°å¯ä»¥æŸ¥çœ‹ï¼š
- ä»»åŠ¡æ•°æ®æ¥æºæ ‡è¯†
- IPFSå“ˆå¸Œæœ‰æ•ˆæ€§çŠ¶æ€
- æ•°æ®å®Œæ•´æ€§è­¦å‘Š

ç¤ºä¾‹ï¼š`http://localhost:3000/tasks?debug=1`

## å‘åå…¼å®¹æ€§

- ä¿æŒæ‰€æœ‰ç°æœ‰APIæ¥å£ä¸å˜
- æ—§ç‰ˆæœ¬IPFSæ•°æ®ä»å¯æ­£å¸¸æ˜¾ç¤º
- æ¸è¿›å¼å¢å¼ºï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

## æŠ€æœ¯ç»†èŠ‚

### æ—¶é—´è®¡ç®—é€»è¾‘
```javascript
// ç«æ ‡é˜¶æ®µæ—¶é—´è®¡ç®—
if (task.createdAt && task.biddingPeriod) {
  const createdTime = new Date(task.createdAt)
  const biddingEndTime = new Date(createdTime.getTime() + (task.biddingPeriod * 60 * 60 * 1000))
  return biddingEndTime < mainDeadline ? biddingEndTime : mainDeadline
}
```

### IPFSæ•°æ®å¤„ç†
- æ•°æ®å­˜å‚¨å±‚å·²å¤„ç†æ— æ•ˆå“ˆå¸Œçš„å›é€€é€»è¾‘
- å‰ç«¯æ˜¾ç¤ºå±‚è¿›ä¸€æ­¥è¿‡æ»¤å’Œä¼˜åŒ–
- ç¼“å­˜æœ‰æ•ˆæ€§æ£€æŸ¥ç»“æœ

## é¢„æœŸæ•ˆæœ

1. **æ—¶é—´ä¿¡æ¯æ›´å‡†ç¡®**ï¼šç”¨æˆ·èƒ½æ¸…æ¥šäº†è§£å½“å‰é˜¶æ®µçš„å…³é”®æ—¶é—´ç‚¹
2. **æ•°æ®è´¨é‡æ›´é«˜**ï¼šå±è”½æ— æ•ˆIPFSæ•°æ®ï¼Œé¿å…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
3. **ç”¨æˆ·ä½“éªŒæ›´å¥½**ï¼šå‡å°‘æ··æ·†ï¼Œæé«˜ä¿¡æ¯çš„å¯è¯»æ€§å’Œå®ç”¨æ€§
4. **è°ƒè¯•æ›´æ–¹ä¾¿**ï¼šå¼€å‘è€…å¯ä»¥å¿«é€Ÿè¯†åˆ«æ•°æ®é—®é¢˜

## æµ‹è¯•å»ºè®®

1. æµ‹è¯•ä¸åŒçŠ¶æ€ä»»åŠ¡çš„æ—¶é—´æ˜¾ç¤º
2. éªŒè¯æ— æ•ˆIPFSå“ˆå¸Œçš„å±è”½æ•ˆæœ
3. æ£€æŸ¥è°ƒè¯•æ¨¡å¼çš„ä¿¡æ¯æ˜¾ç¤º
4. ç¡®è®¤æ—¶é—´é¢œè‰²ç¼–ç çš„å‡†ç¡®æ€§
5. æµ‹è¯•å·²å®Œæˆä»»åŠ¡çš„æ˜¾ç¤ºæ•ˆæœ 